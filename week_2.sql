-- Create the PUBLISHER table
CREATE TABLE PUBLISHER (
    PID NUMBER PRIMARY KEY,
    PNAME VARCHAR2(100),
    ADDRESS VARCHAR2(200),
    STATE VARCHAR2(2),         -- Assuming state abbreviation
    PHONE VARCHAR2(15),
    EMAILID VARCHAR2(100)
);

SELECT * 
from PUBLISHER;

-- Create the BOOK table with a foreign key to PUBLISHER
CREATE TABLE BOOK (
    ISBN VARCHAR2(20) PRIMARY KEY,
    BOOK_TITLE VARCHAR2(200),
    CATEGORY VARCHAR2(50),
    PRICE NUMBER(10,2),
    COPYRIGHT_DATE DATE,
    YEAR NUMBER,
    PAGE_COUNT NUMBER,
    PID NUMBER,
    CONSTRAINT FK_BOOK_PUBLISHER FOREIGN KEY (PID)
        REFERENCES PUBLISHER(PID)
);

-- Create the AUTHOR table
CREATE TABLE AUTHOR (
    AID NUMBER PRIMARY KEY,
    ANAME VARCHAR2(100),
    STATE VARCHAR2(50),
    CITY VARCHAR2(50),
    ZIP VARCHAR2(10),
    PHONE VARCHAR2(15),
    URL VARCHAR2(200)
);

-- Create the AUTHOR_BOOK junction table for the many-to-many relationship
CREATE TABLE AUTHOR_BOOK (
    AID NUMBER,
    ISBN VARCHAR2(20),
    CONSTRAINT PK_AUTHOR_BOOK PRIMARY KEY (AID, ISBN),
    CONSTRAINT FK_AUTHOR_BOOK_AUTHOR FOREIGN KEY (AID)
        REFERENCES AUTHOR(AID),
    CONSTRAINT FK_AUTHOR_BOOK_BOOK FOREIGN KEY (ISBN)
        REFERENCES BOOK(ISBN)
);

-- Create the REVIEW table with a foreign key to BOOK
CREATE TABLE REVIEW (
    RID NUMBER PRIMARY KEY,
    ISBN VARCHAR2(20),
    RATING NUMBER(3,2),
    CONSTRAINT FK_REVIEW_BOOK FOREIGN KEY (ISBN)
        REFERENCES BOOK(ISBN)
);

INSERT INTO PUBLISHER (PID, PNAME, ADDRESS, STATE, PHONE, EMAILID)
VALUES (1, 'O''Reilly Media', '1005 Gravenstein Hwy N, Sebastopol', 'CA', '800-998-9938', 'info@oreilly.com');

INSERT INTO PUBLISHER (PID, PNAME, ADDRESS, STATE, PHONE, EMAILID)
VALUES (2, 'Penguin Random House', '1745 Broadway, New York', 'NY', '212-555-4567', 'contact@penguinrandomhouse.com');

INSERT INTO PUBLISHER (PID, PNAME, ADDRESS, STATE, PHONE, EMAILID)
VALUES (3, 'HarperCollins', '195 Broadway, New York', 'NY', '212-555-7890', 'info@harpercollins.com');



INSERT INTO PUBLISHER (PID, PNAME, ADDRESS, STATE, PHONE, EMAILID)
VALUES (4, 'Simon and Schuster', '1230 Avenue of the Americas, New York', 'NY', '212-555-2345', 'info@simonandschuster.com');

INSERT INTO PUBLISHER (PID, PNAME, ADDRESS, STATE, PHONE, EMAILID)
VALUES (5, 'Macmillan Publishers', '120 Broadway, New York', 'NY', '212-555-6789', 'info@macmillan.com');


INSERT INTO BOOK (ISBN, BOOK_TITLE, CATEGORY, PRICE, COPYRIGHT_DATE, YEAR, PAGE_COUNT, PID)
VALUES ('978-1492051138', 'Learning SQL', 'Technology', 49.99, TO_DATE('2019-04-08','YYYY-MM-DD'), 2019, 350, 1);

INSERT INTO BOOK (ISBN, BOOK_TITLE, CATEGORY, PRICE, COPYRIGHT_DATE, YEAR, PAGE_COUNT, PID)
VALUES ('978-0596009205', 'Head First Java', 'Programming', 39.99, TO_DATE('2005-02-09','YYYY-MM-DD'), 2005, 688, 2);

INSERT INTO BOOK (ISBN, BOOK_TITLE, CATEGORY, PRICE, COPYRIGHT_DATE, YEAR, PAGE_COUNT, PID)
VALUES ('978-0061120084', 'To Kill a Mockingbird', 'Fiction', 15.99, TO_DATE('1960-07-11','YYYY-MM-DD'), 1960, 336, 3);

INSERT INTO BOOK (ISBN, BOOK_TITLE, CATEGORY, PRICE, COPYRIGHT_DATE, YEAR, PAGE_COUNT, PID)
VALUES ('978-0747532743', 'Harry Potter and the Philosopher''s Stone', 'Fantasy', 29.99, TO_DATE('1997-06-26','YYYY-MM-DD'), 1997, 223, 4);

INSERT INTO BOOK (ISBN, BOOK_TITLE, CATEGORY, PRICE, COPYRIGHT_DATE, YEAR, PAGE_COUNT, PID)
VALUES ('978-0316769488', 'The Catcher in the Rye', 'Fiction', 19.99, TO_DATE('1951-07-16','YYYY-MM-DD'), 1951, 277, 5);

INSERT INTO AUTHOR (AID, ANAME, STATE, CITY, ZIP, PHONE, URL)
VALUES (1, 'Alan Beaulieu', 'NY', 'New York', '10001', '212-555-1234', 'http://www.author1.com');

INSERT INTO AUTHOR (AID, ANAME, STATE, CITY, ZIP, PHONE, URL)
VALUES (2, 'Kathy Sierra', 'CA', 'Los Angeles', '90001', '323-555-2345', 'http://www.author2.com');

INSERT INTO AUTHOR (AID, ANAME, STATE, CITY, ZIP, PHONE, URL)
VALUES (3, 'Harper Lee', 'AL', 'Monroeville', '36460', '334-555-3456', 'http://www.author3.com');

INSERT INTO AUTHOR (AID, ANAME, STATE, CITY, ZIP, PHONE, URL)
VALUES (4, 'J.K. Rowling', 'UK', 'Yate', 'BS36', '012-345-6789', 'http://www.author4.com');

INSERT INTO AUTHOR (AID, ANAME, STATE, CITY, ZIP, PHONE, URL)
VALUES (5, 'J.D. Salinger', 'NY', 'New York', '10002', '212-555-5678', 'http://www.author5.com');

INSERT INTO AUTHOR_BOOK (AID, ISBN)
VALUES (1, '978-1492051138');

INSERT INTO AUTHOR_BOOK (AID, ISBN)
VALUES (2, '978-0596009205');

INSERT INTO AUTHOR_BOOK (AID, ISBN)
VALUES (3, '978-0061120084');

INSERT INTO AUTHOR_BOOK (AID, ISBN)
VALUES (4, '978-0747532743');

INSERT INTO AUTHOR_BOOK (AID, ISBN)
VALUES (5, '978-0316769488');


INSERT INTO REVIEW (RID, ISBN, RATING)
VALUES (1, '978-1492051138', 4.5);

INSERT INTO REVIEW (RID, ISBN, RATING)
VALUES (2, '978-0596009205', 4.0);

INSERT INTO REVIEW (RID, ISBN, RATING)
VALUES (3, '978-0061120084', 5.0);

INSERT INTO REVIEW (RID, ISBN, RATING)
VALUES (4, '978-0747532743', 4.8);

INSERT INTO REVIEW (RID, ISBN, RATING)
VALUES (5, '978-0316769488', 3.9);

SELECT * 
from AUTHOR;

SELECT *
from BOOK;

SELECT * 
from AUTHOR_BOOK;

SELECT * 
from REVIEW;


SELECT CITY, PHONE, URL
FROM AUTHOR
WHERE ANAME = 'CHETAN BHAGAT';


SELECT B.BOOK_TITLE, R.RID AS REVIEW_ID, R.RATING
FROM BOOK B
JOIN REVIEW R ON B.ISBN = R.ISBN;

SELECT B.BOOK_TITLE, B.PRICE, A.ANAME, A.URL
FROM BOOK B
JOIN PUBLISHER P ON B.PID = P.PID
JOIN AUTHOR_BOOK AB ON B.ISBN = AB.ISBN
JOIN AUTHOR A ON AB.AID = A.AID
WHERE P.PNAME = 'MEHTA';


UPDATE PUBLISHER
SET PHONE = '123456'
WHERE PNAME = 'MEHTA';

SELECT P.PNAME,
       AVG(B.PRICE) AS AVG_PRICE,
       MAX(B.PRICE) AS MAX_PRICE,
       MIN(B.PRICE) AS MIN_PRICE
FROM BOOK B
JOIN PUBLISHER P ON B.PID = P.PID
GROUP BY P.PNAME;


DELETE FROM BOOK
WHERE PAGE_COUNT < 100;


SELECT *
FROM AUTHOR
WHERE CITY = 'Pune'
  AND ANAME LIKE 'C%';


SELECT *
FROM AUTHOR
WHERE CITY IN (SELECT CITY FROM AUTHOR WHERE ANAME = 'Korth');


